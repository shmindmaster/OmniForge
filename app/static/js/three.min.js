// Minimal Three.js implementation for STL viewing
// In production, replace with actual three.min.js from https://threejs.org/

(function() {
    'use strict';
    
    // Basic 3D math utilities
    function Vector3(x = 0, y = 0, z = 0) {
        this.x = x;
        this.y = y;
        this.z = z;
        
        this.set = function(x, y, z) {
            this.x = x; this.y = y; this.z = z;
            return this;
        };
        
        this.sub = function(v) {
            this.x -= v.x; this.y -= v.y; this.z -= v.z;
            return this;
        };
        
        this.setScalar = function(s) {
            this.x = s; this.y = s; this.z = s;
            return this;
        };
    }
    
    function Color(hex = 0xffffff) {
        this.r = ((hex >> 16) & 255) / 255;
        this.g = ((hex >> 8) & 255) / 255;
        this.b = (hex & 255) / 255;
    }
    
    // Mock geometry
    function BufferGeometry() {
        this.boundingBox = {
            min: new Vector3(-1, -1, -1),
            max: new Vector3(1, 1, 1),
            getCenter: function(target) {
                target.set(0, 0, 0);
                return target;
            },
            getSize: function(target) {
                target.set(2, 2, 2);
                return target;
            }
        };
        
        this.computeBoundingBox = function() {
            // Already computed
        };
    }
    
    // Mock material
    function MeshPhongMaterial(params = {}) {
        this.color = new Color(params.color || 0x8B4B8A);
        this.shininess = params.shininess || 100;
    }
    
    // Mock mesh
    function Mesh(geometry, material) {
        this.geometry = geometry;
        this.material = material;
        this.position = new Vector3();
        this.scale = new Vector3(1, 1, 1);
        this.castShadow = false;
        this.receiveShadow = false;
    }
    
    // Mock scene
    function Scene() {
        this.background = new Color();
        this.children = [];
        this.add = function(obj) {
            this.children.push(obj);
        };
    }
    
    // Mock camera
    function PerspectiveCamera(fov, aspect, near, far) {
        this.fov = fov;
        this.aspect = aspect;
        this.near = near;
        this.far = far;
        this.position = new Vector3();
    }
    
    // Mock lights
    function AmbientLight(color, intensity) {
        this.color = new Color(color);
        this.intensity = intensity;
    }
    
    function DirectionalLight(color, intensity) {
        this.color = new Color(color);
        this.intensity = intensity;
        this.position = new Vector3();
        this.castShadow = false;
    }
    
    // Mock renderer
    function WebGLRenderer(params = {}) {
        this.canvas = params.canvas;
        this.shadowMap = {
            enabled: false,
            type: null
        };
        
        this.setSize = function(width, height) {
            if (this.canvas) {
                this.canvas.width = width;
                this.canvas.height = height;
            }
        };
        
        this.render = function(scene, camera) {
            // Simple 2D canvas rendering to show something is happening
            if (this.canvas) {
                const ctx = this.canvas.getContext('2d');
                ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Draw a simple 3D-ish representation
                ctx.fillStyle = '#f0f0f0';
                ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Draw a simple nail-like shape
                ctx.fillStyle = '#8B4B8A';
                ctx.beginPath();
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                ctx.ellipse(centerX, centerY, 60, 100, 0, 0, 2 * Math.PI);
                ctx.fill();
                
                // Add some "3D" effect
                ctx.fillStyle = '#A569BA';
                ctx.beginPath();
                ctx.ellipse(centerX - 20, centerY - 20, 40, 80, 0, 0, 2 * Math.PI);
                ctx.fill();
                
                // Add text indicating this is a placeholder
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('3D STL Preview', centerX, this.canvas.height - 20);
                ctx.fillText('(Replace with three.js)', centerX, this.canvas.height - 10);
            }
        };
    }
    
    // Export to global THREE object
    window.THREE = {
        Scene: Scene,
        PerspectiveCamera: PerspectiveCamera,
        WebGLRenderer: WebGLRenderer,
        Vector3: Vector3,
        Color: Color,
        AmbientLight: AmbientLight,
        DirectionalLight: DirectionalLight,
        MeshPhongMaterial: MeshPhongMaterial,
        Mesh: Mesh,
        BufferGeometry: BufferGeometry,
        PCFSoftShadowMap: 1
    };
    
})();